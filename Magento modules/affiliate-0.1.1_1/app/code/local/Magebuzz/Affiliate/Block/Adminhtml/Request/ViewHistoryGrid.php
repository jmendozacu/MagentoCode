<?php/** Copyright (c) 2013 www.magebuzz.com */class Magebuzz_Affiliate_Block_Adminhtml_Request_ViewHistoryGrid extends Mage_Adminhtml_Block_Widget_Grid {	public function __construct()  {		parent::__construct();		$this->setId('requestViewGrid');		$this->setDefaultSort('request_id');		$this->setDefaultDir('ASC');		$this->setSaveParametersInSession(true);	}	protected function _prepareCollection() {		$collection = Mage::getModel('affiliate/payment')->getCollection()->addFieldToFilter('main_table.status', array('in' => array(2, 3)));		$collection->getSelect()->join(array('aff'=>Mage::getSingleton('core/resource')->getTableName('affiliate/affiliate')), 'main_table.affiliate_id = aff.affiliate_id', array('aff.email', 'aff.telephone'));		// echo $collection->getSelect()->__toString();		// Zend_Debug::dump($collection->getData());		$this->setCollection($collection);		return parent::_prepareCollection();	}	protected function _getStore(){		$storeId = (int) $this->getRequest()->getParam('store', 0);		return Mage::app()->getStore($storeId);	}		protected function _prepareColumns() {		$store = $this->_getStore();		$this->addColumn('request_id', array(			'header'    => 	Mage::helper('affiliate')->__('ID'),			'align'     =>	'right',			'width'     => 	'50px',			'index'     => 	'request_id',		));		$this->addColumn('email', array(			'header'    => Mage::helper('affiliate')->__('User Email'),			'align'     =>'left',			'index'     => 'email',		));				$this->addColumn('telephone', array(			'header'    => Mage::helper('affiliate')->__('Phone'),			'align'     =>'left',			'index'     => 'telephone',		));				$this->addColumn('request_amount', array(			'header'    => 	Mage::helper('affiliate')->__('Request Amount'),			'align'     =>	'left',			'index'     =>	'request_amount',			'type'  => 'price',			'currency_code' => $store->getBaseCurrency()->getCode(),		));				$this->addColumn('request_time', array(			'header'    =>	Mage::helper('affiliate')->__('Time'),			'align'     =>	'left',			'index'     =>	'request_time',		));				$this->addColumn('request_note', array(			'header'    =>	Mage::helper('affiliate')->__('Request Message'),			'align'     =>	'left',			'index'     =>	'request_note',		));			$this->addColumn('response_note', array(			'header'    =>	Mage::helper('affiliate')->__('Response Message'),			'align'     =>	'left',			'index'     =>	'response_note',		));				$this->addColumn('status', array(			'header'    => Mage::helper('affiliate')->__('Request Status'),			'align'     =>'left',			'index'     => 'status',			'type'      => 'options',			'options'   => array(              2 => 'Rejected',              3 => 'Completed',          ),		));				return parent::_prepareColumns();	}}