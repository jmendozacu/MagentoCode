<?php/** Copyright (c) 2013 www.magebuzz.com */class Magebuzz_Affiliate_Block_Adminhtml_Request_ViewGrid extends Mage_Adminhtml_Block_Widget_Grid {	public function __construct() {		parent::__construct();		$this->setId('requestViewGrid');		$this->setDefaultSort('request_id');		$this->setDefaultDir('ASC');		$this->setSaveParametersInSession(true);	}	protected function _prepareCollection() {		$collection = Mage::getModel('affiliate/payment')->getCollection()->addFieldToFilter('main_table.status', 1);		$collection->getSelect()->join(array('aff'=>Mage::getSingleton('core/resource')->getTableName('affiliate/affiliate')), 'main_table.affiliate_id = aff.affiliate_id', array('aff.*'));		$this->setCollection($collection);		return parent::_prepareCollection();	}			protected function _getStore(){		$storeId = (int) $this->getRequest()->getParam('store', 0);		return Mage::app()->getStore($storeId);	}	protected function _prepareColumns() {		$store = $this->_getStore();		$this->addColumn('request_id', array(			'header'    => 	Mage::helper('affiliate')->__('ID'),			'align'     =>	'right',			'width'     => 	'50px',			'index'     => 	'request_id',		));		$this->addColumn('email', array(			'header'    => Mage::helper('affiliate')->__('User Email'),			'align'     =>'left',			'index'     => 'email',		));				// $this->addColumn('telephone', array(			// 'header'    => Mage::helper('affiliate')->__('Phone'),			// 'align'     =>'left',			// 'index'     => 'telephone',		// ));				$this->addColumn('current_balance', array(			'header'    => Mage::helper('affiliate')->__('Current Balance'),			'align'     =>'left',			'index'     => 'current_balance',			'type'  => 'price',			'currency_code' => $store->getBaseCurrency()->getCode(),		));				$this->addColumn('total_withdrawn', array(			'header'    => Mage::helper('affiliate')->__('Total Withdrawn'),			'align'     =>'left',			'index'     => 'total_withdrawn',			'type'  => 'price',			'currency_code' => $store->getBaseCurrency()->getCode(),		));				$this->addColumn('status', array(			'header'    => Mage::helper('affiliate')->__('User Status'),			'align'     =>'left',			'index'     => 'status',			'type'      => 'options',			'options'   => array(              1 => 'Active',              2 => 'Inactive',          ),		));				$this->addColumn('request_amount', array(			'header'    => 	Mage::helper('affiliate')->__('Request Amount'),			'align'     =>	'left',			'index'     =>	'request_amount',			'type'  => 'price',			'currency_code' => $store->getBaseCurrency()->getCode(),		));				$this->addColumn('request_time', array(			'header'    =>	Mage::helper('affiliate')->__('Time'),			'align'     =>	'left',			'index'     =>	'request_time',		));				$this->addColumn('request_note', array(			'header'    =>	Mage::helper('affiliate')->__('Request Message'),			'align'     =>	'left',			'index'     =>	'request_note',		));		return parent::_prepareColumns();	}		protected function _prepareMassaction() {		$this->setMassactionIdField('request_id');		$this->getMassactionBlock()->setFormFieldName('affiliate');		$statuses = Mage::getSingleton('affiliate/requestStatus')->getOptionArray();				$this->getMassactionBlock()->addItem('status', array(				 'label'=> Mage::helper('affiliate')->__('Action'),				 'url'  => $this->getUrl('*/*/massChangeStatus', array('_current'=>true)),				 'additional' => array(								'visibility' => array(										 'name' => 'status',										 'type' => 'select',										 'class' => 'required-entry',										 'label' => Mage::helper('affiliate')->__('Status'),										 'values' => $statuses								 )				 )		));		return $this;	}	public function getRowUrl($row) {		return $this->getUrl('*/*/viewSpecificRequest', array('id' => $row->getId()));	}}